@model IEnumerable<prjVegetable.Models.CPersonWrap>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_LayoutERP.cshtml";
}

<h1>人員資料列表</h1>
<br />
<div id="app">
    <div>
        <label class="form-label">搜尋</label>
        <input v-model="keyword" placeholder="請輸入搜尋" />
        <button type="button" class="btn btn-primary" @@click="search">查詢</button>
    </div>
    <!-- 新增資料 -->
    <p>
        <a href="/Person/Create" class="btn btn-outline-primary">新增資料</a>
    </p>
    <!-- 顯示資料 -->
    <table class="table">
        <thead>
            <tr>
                <th>序號</th>
                <th>ID</th>
                <th>姓名</th>
                <th>帳號</th>
                <th>密碼</th>
                <th>性別</th>
                <th>生日</th>
                <th>手機</th>
                <th>家用電話</th>
                <th>電子郵件</th> 
                <th>操作</th>
            </tr>
        </thead>
        <tbody v-if="CPersonWrap.length > 0">
            <tr v-for="(item, index) in CPersonWrap" :key="item.fId">
                <td>{{ index + 1 }}</td>
                <th>{{item.fId}}</th>
                <td>{{ item.fName }}</td>
                <th>{{item.fAccount}}</th>
                <th>{{item.fPassword}}</th>                
                <td>{{ item.fGender }}</td>
                <td>{{ item.fBirth }}</td>
                <td>{{ item.fPhone }}</td>
                <td>{{ item.fTel }}</td>
                <td>{{ item.fEmail }}</td>
                <td>
                    <a :href="'/Person/Edit/' + item.fId">編輯資料</a><br />
                    <a :href="'/Person/Details/' + item.fId">詳細資料</a><br />
                    <a :href="'/Person/Delete?id=' + item.fId" @@click.prevent="confirmDelete(item.fId)">移除</a>
                </td>
            </tr>
        </tbody>
    </table>
</div>

@section Scripts {
    
    <script>
        const app = Vue.createApp({
            data() {
                return {
                    CPersonWrap: [], // 儲存所有人員資料
                    keyword: "", // 搜尋關鍵字                   
                };
            },
            mounted() {
                this.loadPeople();
            },
            methods: {
                // 透過API獲取所有人員資料
                loadPeople() {
                    axios.get('/Person/GetPeople').then(response=>{
                        console.log(response.data);  // 在這裡查看 API 返回的資料
                        this.CPersonWrap=Array.isArray(response.data)?response.data:[];
                    }).catch(error=>{
                        console.error('資料載入錯誤', error)
                    });
                },
                search() {
                    if (this.keyword === '') {
                        this.loadPeople(); // 若沒有搜尋關鍵字，重新載入所有資料
                    } else {
                        this.CPersonWrap = this.CPersonWrap.filter(person =>
                            person.fName.includes(this.keyword) ||
                            person.fPhone.includes(this.keyword) ||
                            person.fEmail.includes(this.keyword) ||
                            person.fAddress.includes(this.keyword)
                        );
                    }
                },
                // 刪除人員資料
                confirmDelete(id) {
                    if (confirm('確定要刪除這筆資料嗎?')) {
                        axios.delete(`/Person/Delete?id=${id}`)
                            .then(() => {
                                // 刪除後重新載入資料
                                this.loadPeople(); // 重新加載資料
                            })
                            .catch(error => {
                                console.error('刪除失敗', error);
                            });
                    }
                }
            } // 這裡結束 methods 部分
        }); // 這裡結束 Vue.createApp 的程式碼

             
        app.mount('#app'); // 使用 Vue 3 創建並掛載應用
    </script>
}
